var wrapper=document.getElementsByClassName("wrapper")[0];var currentPosition;var pageNow=1;var recomCarousel=new Carousel();var kaikeCarousel=new Carousel();window.onload=function(){getHomeHTML();bottomNavClick()};function getHomeHTML(){getHTML("pages/home.html",function(a){wrapper.innerHTML=a;loadView(1);setPageWidth();bindHomeNavClick();bindTouchEvent();setNavLinePos(0)})}function expandClick(){var c=document.getElementsByClassName("other-left"),a=c.length;for(var b=0;b<a;b++){c[b].onclick=function(){if(this.closest(".flash-right-content").classList.contains("show")){this.closest(".flash-right-content").classList.remove("show");this.setAttribute("data-txt","展开")}else{this.closest(".flash-right-content").classList.add("show");this.setAttribute("data-txt","收起")}}}}function getKaikeHTML(){getHTML("pages/kaike.html",function(a){wrapper.innerHTML=a;getObj("data/kaike-crs-data.json",function(c){var b=Array.prototype.slice.call(c.images);kaikeCarousel.setUlNode("crsUl");kaikeCarousel.setRoundNode("round-icons");kaikeCarousel.setCheckedName("round-checked");kaikeCarousel.init(b);kaikeCarousel.autoplay(1500)})})}function getDiscHTML(){getHTML("pages/disc.html",function(a){wrapper.innerHTML=a})}function getMineHTML(){getHTML("pages/mine.html",function(a){wrapper.innerHTML=a})}function bottomNavClick(){var c=document.getElementsByClassName("footerNav")[0].children,a=c.length;for(var b=0;b<a;b++){c[b].index=b;c[b].onclick=function(){switch(this.index){case 0:getHomeHTML();break;case 1:getKaikeHTML();break;case 2:getDiscHTML();break;case 3:getMineHTML();break;default:break}document.getElementsByClassName("checked")[0].classList.remove("checked");this.classList.add("checked");recomCarousel.stopAutoPlay();if(this.index!==1){kaikeCarousel.stopAutoPlay()}}}}function setPageWidth(){var d=document.getElementsByClassName("content-view"),a=d.length;var c=window.innerWidth;for(var b=0;b<a;b++){d[b].style.width=c+"px"}}function transform(a){this.style.webkitTransform="translate3d("+a+"px,0,0)";currentPosition=a}function bindHomeNavClick(){var b=document.getElementsByClassName("home-nav")[0].getElementsByTagName("li"),a=b.length;var d=document.getElementsByClassName("home-content")[0];for(var c=0;c<a;c++){b[c].index=c;b[c].onclick=function(){var e=window.innerWidth;setNavLinePos(this.index);if(this.index!==1){recomCarousel.stopAutoPlay()}loadView(this.index+1);transform.call(d,-e*(this.index))}}}function bindTouchEvent(){currentPosition=0;var k=document.getElementById("home-content");var l=document.getElementsByClassName("content-view");var i;var j;var d,c;var b=0;var h=0;var f="left";var g=false;var a=0;var e=true;k.addEventListener("touchstart",function(n){i=window.innerWidth;j=-i*(l.length-1);var m=n.targetTouches[0].target;if(!m.closest(".crsUl")){if(n.touches.length===1||e){var o=n.touches[0];d=o.pageX;c=o.pageY;b=currentPosition;k.style.webkitTransition="";a=new Date().getTime();g=false;e=false}}},false);k.addEventListener("touchmove",function(p){var o=p.targetTouches[0].target;if(!o.closest(".crsUl")){var r=p.touches[0];var n=r.pageX-d;var m=r.pageY-c;if(Math.abs(n)>Math.abs(m)){p.preventDefault();h=n;var q=b+n;if(q<=0&&q>=j){transform.call(k,q);g=true}f=n>0?"right":"left"}}},false);k.addEventListener("touchend",function(n){var o=0;var m=new Date().getTime()-a;if(g&&!e){e=true;k.style.webkitTransition="-webkit-transform 0.3s ease";if(m<300){o=f==="left"?currentPosition-(i+h):currentPosition+i-h;o=o>0?0:o;o=o<j?j:o}else{if(Math.abs(h)/i<0.5){o=currentPosition-h}else{o=f==="left"?currentPosition-(i+h):currentPosition+i-h;o=o>0?0:o;o=o<j?j:o}}setTimeout(function(){transform.call(k,o)},100);pageNow=Math.round(Math.abs(o)/i)+1;loadView(pageNow);setNavLinePos(pageNow-1)}},false)}function setNavLinePos(b){var a=document.getElementsByClassName("slide-nav");document.getElementsByClassName("show")[0].classList.remove("show");a[b].classList.add("show")}function loadView(b){var a="";var c=document.getElementsByClassName("content-view");switch(b){case 1:a="pages/focus-view-normal.html";break;case 2:a="pages/recom-view.html";break;case 3:a="pages/flash-view.html";break;default:break}if(b<4){getHTML(a,function(d){c[b-1].innerHTML=d;if(b===2){getObj("data/recom-crs-data.json",function(f){var e=Array.prototype.slice.call(f.images);recomCarousel.setUlNode("crsUl");recomCarousel.setRoundNode("round-icons");recomCarousel.setCheckedName("round-checked");recomCarousel.init(e);recomCarousel.autoplay(1500);cslTouchEvent()})}else{if(b===3){expandClick()}recomCarousel.stopAutoPlay()}})}}function cslTouchEvent(){var c=document.getElementsByClassName("crsUl")[0];var b,a;var d=window.innerWidth;var f=-d*(c.children.length);var e=0;isTouchEnd=true;c.addEventListener("touchstart",function(g){if(g.touches.length===1||isTouchEnd){var h=g.touches[0];b=h.pageX;a=h.pageY;e=new Date().getTime();isMove=false;isTouchEnd=false}},false);c.addEventListener("touchmove",function(i){var j=i.touches[0];var h=j.pageX-b;var g=j.pageY-a;if(Math.abs(h)>Math.abs(g)){i.preventDefault()}},false)}function getJSON(a,c){var b=new XMLHttpRequest();b.open("GET",a);b.send();b.onreadystatechange=function(){if(b.readyState===4&&b.status===200){var d=b.responseText;c(d)}}}function getHTML(a,c){var b=new XMLHttpRequest();b.open("GET",a);b.send();b.onreadystatechange=function(){if(b.readyState===4&&b.status===200){var d=b.responseText;c(d)}}}function getObj(a,c){var b=new XMLHttpRequest();b.open("GET",a);b.send();b.onreadystatechange=function(){if(b.readyState===4&&b.status===200){var d=JSON.parse(b.responseText);c(d)}}};